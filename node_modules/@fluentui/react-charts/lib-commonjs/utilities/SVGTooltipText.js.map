{"version":3,"sources":["../src/utilities/SVGTooltipText.tsx"],"sourcesContent":["'use client';\n\nimport * as React from 'react';\nimport { useState, useRef, useEffect, useCallback } from 'react';\nimport { usePortalMountNode } from '@fluentui/react-shared-contexts';\nimport { Tooltip } from '@fluentui/react-tooltip';\nimport { Async } from './async-utils';\nimport { KeyCodes } from './KeyCodes';\nimport { useId } from '@fluentui/react-utilities';\n\nexport interface SVGTooltipTextProps {\n  closeDelay?: number;\n  content: string;\n  delay?: number;\n  tooltipProps?: React.ComponentProps<typeof Tooltip>;\n  textProps?: React.SVGAttributes<SVGTextElement>;\n  maxWidth?: number;\n  maxHeight?: number;\n  shouldReceiveFocus?: boolean;\n  isTooltipVisibleProp?: boolean;\n  wrapContent?: (content: string, id: string, maxWidth: number, maxHeight?: number) => boolean;\n  showBackground?: boolean;\n  className?: string;\n}\n\nexport const SVGTooltipText: React.FunctionComponent<SVGTooltipTextProps> = React.forwardRef<\n  HTMLDivElement,\n  SVGTooltipTextProps\n>((props, forwardedRef) => {\n  const [isTooltipVisible, setIsTooltipVisible] = useState(false);\n  const [isOverflowing, setIsOverflowing] = useState(false);\n  const [textWidth, setTextWidth] = useState(0);\n  const [textHeight, setTextHeight] = useState(0);\n\n  const tooltipHostRef = useRef<SVGTextElement>(null);\n  const async = useRef(new Async()).current;\n  const dismissTimerId = useRef<number>();\n  const openTimerId = useRef<number>();\n  const tooltipHostId = useRef(useId('tooltip-host')).current;\n  const ignoreNextFocusEvent = useRef(false);\n  const portalMountNode = usePortalMountNode();\n  const PADDING = 3;\n\n  const wrapContentCallback = useCallback(() => {\n    if (\n      props.content &&\n      props.wrapContent &&\n      props.wrapContent(props.content, tooltipHostId, props.maxWidth ?? 100, props.maxHeight)\n      // ToDo - Specify a correct fallback value here\n    ) {\n      setIsOverflowing(true);\n    } else {\n      setIsOverflowing(false);\n    }\n  }, [props, tooltipHostId]);\n\n  const measureText = useCallback((): void => {\n    if (tooltipHostRef.current && typeof tooltipHostRef.current.getBBox === 'function') {\n      const bbox = tooltipHostRef.current.getBBox();\n      setTextWidth(bbox.width);\n      setTextHeight(bbox.height);\n    }\n  }, []);\n\n  useEffect(() => {\n    wrapContentCallback();\n    return () => {\n      async.dispose();\n    };\n  }, [wrapContentCallback, async]);\n\n  useEffect(() => {\n    wrapContentCallback();\n  }, [props.maxWidth, props.maxHeight, wrapContentCallback]);\n\n  useEffect(() => {\n    if (isTooltipVisible) {\n      measureText();\n    }\n  }, [isTooltipVisible, measureText]);\n\n  useEffect(() => {\n    // Recalculate text dimensions when content or dimensions change\n    measureText();\n  }, [props.content, props.textProps, props.maxWidth, props.maxHeight, measureText]);\n\n  const hideTooltip = useCallback(() => {\n    async.clearTimeout(openTimerId.current!);\n    async.clearTimeout(dismissTimerId.current!);\n    setIsTooltipVisible(false);\n  }, [async]);\n\n  const onTooltipMouseEnter = useCallback(\n    (ev: React.MouseEvent<SVGElement>) => {\n      if (!isOverflowing) {\n        return;\n      }\n\n      if (ev.target && portalMountNode?.contains(ev.target as HTMLElement)) {\n        return;\n      }\n\n      async.clearTimeout(dismissTimerId.current!);\n      async.clearTimeout(openTimerId.current!);\n\n      if (props.delay !== 0) {\n        openTimerId.current = async.setTimeout(() => {\n          setIsTooltipVisible(true);\n        }, props.delay!);\n      } else {\n        setIsTooltipVisible(true);\n      }\n    },\n    [isOverflowing, portalMountNode, async, props.delay],\n  );\n\n  const onTooltipMouseLeave = useCallback(\n    (ev: React.MouseEvent<SVGElement>) => {\n      async.clearTimeout(dismissTimerId.current!);\n      async.clearTimeout(openTimerId.current!);\n\n      if (props.closeDelay) {\n        dismissTimerId.current = async.setTimeout(() => {\n          setIsTooltipVisible(false);\n        }, props.closeDelay);\n      } else {\n        setIsTooltipVisible(false);\n      }\n    },\n    [async, props.closeDelay],\n  );\n\n  const onTooltipFocus = useCallback(\n    (ev: React.FocusEvent<SVGElement>) => {\n      if (ignoreNextFocusEvent.current) {\n        ignoreNextFocusEvent.current = false;\n        return;\n      }\n      onTooltipMouseEnter(ev as unknown as React.MouseEvent<SVGElement>);\n    },\n    [onTooltipMouseEnter],\n  );\n\n  const onTooltipBlur = useCallback(\n    (ev: React.FocusEvent<SVGElement>) => {\n      ignoreNextFocusEvent.current = document?.activeElement === ev.target;\n      dismissTimerId.current = async.setTimeout(() => {\n        setIsTooltipVisible(false);\n      }, 0);\n    },\n    [async],\n  );\n\n  const onTooltipKeyDown = useCallback(\n    (ev: React.KeyboardEvent<SVGElement>) => {\n      // eslint-disable-next-line @typescript-eslint/no-deprecated\n      if ((ev.which === KeyCodes.escape || ev.ctrlKey) && isTooltipVisible) {\n        hideTooltip();\n        ev.stopPropagation();\n      }\n    },\n    [isTooltipVisible, hideTooltip],\n  );\n\n  const showTooltip =\n    (props.isTooltipVisibleProp && isOverflowing && !!props.content) || (isTooltipVisible && !!props.content);\n\n  const rectX = (typeof props.textProps?.x === 'number' ? props.textProps.x : 0) - (textWidth ?? 0) / 2 - PADDING;\n  const rectY = (typeof props.textProps?.y === 'number' ? props.textProps.y : 0) - (textHeight ?? 0) / 2 - 2 * PADDING;\n\n  return (\n    <>\n      {props.showBackground && (\n        <rect\n          x={rectX}\n          y={rectY}\n          width={(textWidth ?? 0) + 2 * PADDING}\n          height={(textHeight ?? 0) + PADDING}\n          transform={props.textProps?.transform}\n          className={props.className}\n        />\n      )}\n      <Tooltip\n        relationship=\"description\"\n        {...props.tooltipProps}\n        withArrow\n        content={props.content}\n        // targetElement={getTargetElement()} ToDo - This assignment is causing build failure. Needs to be fixed.\n        visible={showTooltip}\n      >\n        <text\n          {...props.textProps}\n          id={tooltipHostId}\n          ref={tooltipHostRef}\n          onFocusCapture={onTooltipFocus}\n          onBlurCapture={onTooltipBlur}\n          onMouseEnter={onTooltipMouseEnter}\n          onMouseLeave={onTooltipMouseLeave}\n          onKeyDown={onTooltipKeyDown}\n          data-is-focusable={props.shouldReceiveFocus && isOverflowing}\n        >\n          {props.content}\n        </text>\n      </Tooltip>\n    </>\n  );\n});\n// eslint-disable-next-line @typescript-eslint/no-deprecated\nSVGTooltipText.defaultProps = {\n  delay: 0,\n  showBackground: false,\n};\n"],"names":["React","useState","useRef","useEffect","useCallback","usePortalMountNode","Tooltip","Async","KeyCodes","useId","SVGTooltipText","forwardRef","props","forwardedRef","isTooltipVisible","setIsTooltipVisible","isOverflowing","setIsOverflowing","textWidth","setTextWidth","textHeight","setTextHeight","tooltipHostRef","async","current","dismissTimerId","openTimerId","tooltipHostId","ignoreNextFocusEvent","portalMountNode","PADDING","wrapContentCallback","content","wrapContent","maxWidth","maxHeight","measureText","getBBox","bbox","width","height","dispose","textProps","hideTooltip","clearTimeout","onTooltipMouseEnter","ev","target","contains","delay","setTimeout","onTooltipMouseLeave","closeDelay","onTooltipFocus","onTooltipBlur","document","activeElement","onTooltipKeyDown","which","escape","ctrlKey","stopPropagation","showTooltip","isTooltipVisibleProp","rectX","x","rectY","y","showBackground","rect","transform","className","relationship","tooltipProps","withArrow","visible","text","id","ref","onFocusCapture","onBlurCapture","onMouseEnter","onMouseLeave","onKeyDown","data-is-focusable","shouldReceiveFocus","defaultProps"],"mappings":"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"}