{"version":3,"sources":["../src/components/DonutChart/Arc/Arc.tsx"],"sourcesContent":["'use client';\n\nimport * as React from 'react';\nimport { arc as d3Arc } from 'd3-shape';\nimport { useArcStyles } from './useArcStyles.styles';\nimport { ChartDataPoint } from '../index';\nimport { ArcProps } from './index';\nimport { format as d3Format } from 'd3-format';\nimport { formatScientificLimitWidth, useRtl } from '../../../utilities/index';\n\n// Create a Arc within Donut Chart variant which uses these default styles and this styled subcomponent.\n/**\n * Arc component within Donut Chart.\n * {@docCategory ArcDonutChart}\n */\nexport const Arc: React.FunctionComponent<ArcProps> = React.forwardRef<HTMLDivElement, ArcProps>(\n  (props, forwardedRef) => {\n    const arc = d3Arc();\n    const currentRef = React.createRef<SVGPathElement>();\n    const _isRTL: boolean = useRtl();\n    const classes = useArcStyles(props);\n\n    React.useEffect(() => {\n      _updateChart(props);\n    }, [props]);\n\n    function _onFocus(\n      data: ChartDataPoint,\n      id: string,\n      event: React.FocusEvent<SVGPathElement, Element>,\n      targetElement?: HTMLElement | null,\n    ): void {\n      props.onFocusCallback!(data, id, event, currentRef.current, targetElement);\n    }\n\n    function _hoverOn(\n      data: ChartDataPoint,\n      mouseEvent: React.MouseEvent<SVGPathElement>,\n      targetElement?: HTMLElement | null,\n    ): void {\n      mouseEvent.persist();\n      props.hoverOnCallback!(data, mouseEvent, targetElement);\n    }\n\n    function _hoverOff(): void {\n      props.hoverLeaveCallback!();\n    }\n\n    function _onBlur(): void {\n      props.onBlurCallback!();\n    }\n\n    function _getAriaLabel(): string {\n      const point = props.data!.data;\n      const legend = point.xAxisCalloutData || point.legend;\n      const yValue = point.yAxisCalloutData || point.data || 0;\n      return point.callOutAccessibilityData?.ariaLabel || (legend ? `${legend}, ` : '') + `${yValue}.`;\n    }\n\n    function _shouldHighlightArc(legend?: string): boolean {\n      const { activeArc } = props;\n      // If no activeArc is provided, highlight all arcs. Otherwise, only highlight the arcs that are active.\n      return !activeArc || activeArc.length === 0 || legend === undefined || activeArc.includes(legend);\n    }\n\n    function _renderArcLabel(className: string) {\n      const { data, innerRadius, outerRadius, showLabelsInPercent, totalValue, hideLabels } = props;\n\n      if (\n        hideLabels ||\n        Math.abs(data!.endAngle - data!.startAngle) < Math.PI / 12 ||\n        !_shouldHighlightArc(data!.data.legend!)\n      ) {\n        return null;\n      }\n\n      const [base, perp] = arc.centroid({ ...data!, innerRadius, outerRadius });\n      const hyp = Math.sqrt(base * base + perp * perp);\n      const labelRadius = Math.max(innerRadius!, outerRadius!) + 2;\n      const angle = (data!.startAngle + data!.endAngle) / 2;\n      const arcValue = data!.value;\n\n      return (\n        <text\n          x={(hyp === 0 ? 0 : base / hyp) * labelRadius}\n          y={(hyp === 0 ? 0 : perp / hyp) * labelRadius}\n          textAnchor={angle > Math.PI !== _isRTL ? 'end' : 'start'}\n          dominantBaseline={angle > Math.PI / 2 && angle < (3 * Math.PI) / 2 ? 'hanging' : 'auto'}\n          className={className}\n          aria-hidden={true}\n        >\n          {showLabelsInPercent\n            ? d3Format('.0%')(totalValue! === 0 ? 0 : arcValue / totalValue!)\n            : formatScientificLimitWidth(arcValue)}\n        </text>\n      );\n    }\n\n    function _updateChart(newProps: ArcProps): void {\n      if (newProps.arc && newProps.innerRadius && newProps.outerRadius) {\n        newProps.arc.innerRadius(newProps.innerRadius);\n        newProps.arc.outerRadius(newProps.outerRadius);\n      }\n    }\n\n    const { href, focusedArcId, activeArc } = props;\n    //TO DO 'replace' is throwing error\n    const id =\n      props.uniqText! +\n      (typeof props.data!.data.legend === 'string' ? props.data!.data.legend.replace(/\\s+/g, '') : '') +\n      props.data!.data.data;\n    const opacity: number =\n      activeArc && activeArc.length > 0 ? (activeArc.includes(props.data?.data.legend!) ? 1 : 0.1) : 1;\n    const cornerRadius = props.roundCorners ? 3 : 0;\n    const targetElement = document.getElementById(id);\n    return (\n      <g ref={currentRef}>\n        {!!focusedArcId && focusedArcId === id && (\n          // TODO innerradius and outerradius were absent\n          <path\n            id={id + 'focusRing'}\n            d={\n              arc.cornerRadius(cornerRadius)({\n                ...props.data!,\n                innerRadius: props.innerRadius,\n                outerRadius: props.outerRadius,\n              })!\n            }\n            className={classes.focusRing}\n          />\n        )}\n        <path\n          // TODO innerradius and outerradius were absent\n          id={id}\n          d={\n            arc.cornerRadius(cornerRadius)({\n              ...props.data!,\n              innerRadius: props.innerRadius,\n              outerRadius: props.outerRadius,\n            })!\n          }\n          className={classes.root}\n          style={{ fill: props.color, cursor: href ? 'pointer' : 'default' }}\n          onFocus={event => _onFocus(props.data!.data, id, event, targetElement)}\n          onMouseOver={event => _hoverOn(props.data!.data, event, targetElement)}\n          onMouseMove={event => _hoverOn(props.data!.data, event, targetElement)}\n          onMouseLeave={_hoverOff}\n          tabIndex={_shouldHighlightArc(props.data!.data.legend!) || props.activeArc?.length === 0 ? 0 : undefined}\n          onBlur={_onBlur}\n          opacity={opacity}\n          onClick={props.data?.data.onClick}\n          aria-label={_getAriaLabel()}\n          role=\"img\"\n        />\n        {_renderArcLabel(classes.arcLabel)}\n      </g>\n    );\n  },\n);\nArc.displayName = 'Arc';\n"],"names":["React","arc","d3Arc","useArcStyles","format","d3Format","formatScientificLimitWidth","useRtl","Arc","forwardRef","props","forwardedRef","currentRef","createRef","_isRTL","classes","useEffect","_updateChart","_onFocus","data","id","event","targetElement","onFocusCallback","current","_hoverOn","mouseEvent","persist","hoverOnCallback","_hoverOff","hoverLeaveCallback","_onBlur","onBlurCallback","_getAriaLabel","point","legend","xAxisCalloutData","yValue","yAxisCalloutData","callOutAccessibilityData","ariaLabel","_shouldHighlightArc","activeArc","length","undefined","includes","_renderArcLabel","className","innerRadius","outerRadius","showLabelsInPercent","totalValue","hideLabels","Math","abs","endAngle","startAngle","PI","base","perp","centroid","hyp","sqrt","labelRadius","max","angle","arcValue","value","text","x","y","textAnchor","dominantBaseline","aria-hidden","newProps","href","focusedArcId","uniqText","replace","opacity","cornerRadius","roundCorners","document","getElementById","g","ref","path","d","focusRing","root","style","fill","color","cursor","onFocus","onMouseOver","onMouseMove","onMouseLeave","tabIndex","onBlur","onClick","aria-label","role","arcLabel","displayName"],"mappings":"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"}